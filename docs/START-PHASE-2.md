# 🚀 阶段2开发启动指南

**启动日期**: 2026-02-26
**今日任务**: Day 1 - 环境启动与功能验证

---

## ⏰ 今日时间安排

| 时间 | 任务 | 预计耗时 |
|------|------|----------|
| 09:00 - 09:30 | 环境检查和准备 | 30分钟 |
| 09:30 - 11:00 | 完整功能测试 | 1.5小时 |
| 11:00 - 12:00 | 问题修复和优化 | 1小时 |
| **午休** | | |
| 14:00 - 15:30 | 代码质量检查 | 1.5小时 |
| 15:30 - 17:00 | 编写测试报告 | 1.5小时 |
| 17:00 - 17:30 | 更新工作日志 | 30分钟 |

**总耗时**: 约6小时

---

## 📋 Task 2.1: 环境启动与功能验证

### 第一步: 环境检查 (09:00 - 09:30)

#### 1.1 检查 Git 状态

```bash
# 查看当前分支
git branch

# 查看最新提交
git log --oneline -5

# 确保代码最新
git pull origin main

# 创建阶段2工作分支
git checkout -b phase-2-development
```

**预期结果**:
```
* phase-2-development
  main
```

---

#### 1.2 检查 Docker 容器

```bash
# 查看所有容器
docker ps -a

# 查找 PostgreSQL 容器
docker ps -a | grep postgres
```

**预期输出**:
```
CONTAINER ID   IMAGE          STATUS                     NAMES
xxxxxxxxxx     postgres:16    Exited (0) X hours ago    postgres-pottery
```

**如果容器不存在**，创建新容器:
```bash
docker run --name postgres-pottery \
  -e POSTGRES_PASSWORD=postgres \
  -e POSTGRES_DB=pottery_kb \
  -p 5433:5432 \
  -d postgres:16
```

---

#### 1.3 启动数据库

```bash
# 启动容器
docker start postgres-pottery

# 验证运行状态
docker ps | grep postgres-pottery

# 测试连接
docker exec -it postgres-pottery psql -U postgres -d pottery_kb -c "SELECT version();"
```

**预期输出**:
```
PostgreSQL 16.x on x86_64-pc-linux-gnu, compiled by gcc...
```

---

#### 1.4 检查数据库数据

```bash
# 检查表是否存在
docker exec -it postgres-pottery psql -U postgres -d pottery_kb -c "\dt"

# 检查陶器条目数量
docker exec -it postgres-pottery psql -U postgres -d pottery_kb -c "SELECT COUNT(*) FROM \"PotteryEntry\";"

# 检查作家数量
docker exec -it postgres-pottery psql -U postgres -d pottery_kb -c "SELECT COUNT(*) FROM \"Artist\";"
```

**预期结果**:
```
PotteryEntry: 21 rows
Artist: 60 rows
```

**如果数据为空**，运行 seed:
```bash
pnpm prisma db seed
```

---

#### 1.5 启动开发服务器

```bash
# 确保依赖已安装
pnpm install

# 生成 Prisma Client
pnpm prisma generate

# 启动开发服务器
pnpm dev
```

**预期输出**:
```
  ▲ Next.js 14.x
  - Local:        http://localhost:3000
  - Network:      http://192.168.x.x:3000

 ✓ Ready in 2.5s
```

---

#### 1.6 打开 Prisma Studio (可选)

在新终端窗口:
```bash
pnpm prisma studio
```

访问: http://localhost:5555

**用途**: 可视化查看和编辑数据库数据

---

### ✅ 环境检查清单

完成后勾选:

- [ ] Git 分支创建成功 (`phase-2-development`)
- [ ] PostgreSQL 容器运行中
- [ ] 数据库包含 21 个陶器条目
- [ ] 数据库包含 60 位作家
- [ ] 开发服务器启动成功 (http://localhost:3000)
- [ ] Prisma Studio 可访问 (可选)

---

## 第二步: 完整功能测试 (09:30 - 11:00)

### 2.1 前台页面测试

#### 测试 1: 首页加载

**访问**: http://localhost:3000

**检查项**:
- [ ] 页面正常加载，无白屏
- [ ] 显示 21 个陶器条目
- [ ] 图片正常显示（如有）
- [ ] 卡片样式正确
- [ ] 分页功能正常（如超过20条）
- [ ] 响应式布局正常（缩小浏览器窗口测试）

**记录**:
- 加载时间: ________ ms (使用浏览器 DevTools Network 标签)
- 发现的问题:
  -

---

#### 测试 2: 搜索功能

**位置**: 首页搜索框

**测试用例**:

| 测试 | 搜索词 | 预期结果 |
|------|--------|----------|
| 2.1 | `备前` | 显示备前烧相关条目 |
| 2.2 | `六古窯` | 显示六古窑条目 |
| 2.3 | `信乐` | 显示信乐烧条目 |
| 2.4 | `Bizen` | 显示备前烧（英文搜索） |
| 2.5 | `不存在的内容` | 显示"未找到匹配的条目" |

**检查项**:
- [ ] 搜索建议下拉框显示（输入时）
- [ ] 防抖生效（输入停止300ms后才搜索）
- [ ] 搜索结果正确
- [ ] 搜索结果数量显示
- [ ] 清空搜索后恢复完整列表

**记录**:
- 搜索响应时间: ________ ms
- 发现的问题:
  -

---

#### 测试 3: 详情页

**访问**: http://localhost:3000/pottery/bizen-yaki

**检查项**:
- [ ] 页面正常加载
- [ ] 标题正确显示（中文、日文、英文名）
- [ ] 面包屑导航正常
- [ ] 基础信息卡片显示完整
- [ ] 识别特征列表显示
- [ ] 知名作家列表显示
- [ ] 代表器型列表显示
- [ ] 参考来源链接可点击
- [ ] 关键词标签显示
- [ ] 图片画廊正常（如有图片）
- [ ] 响应式布局正常

**测试更多条目**:
- http://localhost:3000/pottery/shigaraki-yaki
- http://localhost:3000/pottery/tokoname-yaki
- http://localhost:3000/pottery/mashiko

**记录**:
- 详情页加载时间: ________ ms
- 发现的问题:
  -

---

#### 测试 4: 作家页面

**访问**: http://localhost:3000/artists

**检查项**:
- [ ] 页面正常加载
- [ ] 显示 60 位作家
- [ ] 作家卡片样式正确
- [ ] 分页功能正常
- [ ] 可点击进入详情页

**访问作家详情**: http://localhost:3000/artists/kurokawa-toru

**检查项**:
- [ ] 作家信息完整显示
- [ ] 简介内容显示
- [ ] Instagram 链接可点击（如有）
- [ ] 相关陶器作品显示（如有关联）
- [ ] 参考来源链接正常

**测试更多作家**:
- http://localhost:3000/artists/hamada-tomoo
- http://localhost:3000/artists/kuwata-takuro

**记录**:
- 作家列表加载时间: ________ ms
- 作家详情加载时间: ________ ms
- 发现的问题:
  -

---

### 2.2 管理后台测试

#### 测试 5: 登录功能

**访问**: http://localhost:3000/admin/login

**测试步骤**:
1. 输入密码: `admin123`
2. 点击"登录"按钮

**检查项**:
- [ ] 登录页面正常显示
- [ ] 密码输入框正常
- [ ] 登录成功后跳转到仪表盘
- [ ] Cookie 设置成功（可在 DevTools > Application 查看）

**记录**:
- 发现的问题:
  -

---

#### 测试 6: 仪表盘

**访问**: http://localhost:3000/admin

**检查项**:
- [ ] 统计卡片显示正确
  - [ ] 总条目数: 21
  - [ ] 总作家数: 60
  - [ ] 其他统计数据
- [ ] 最近更新列表显示
- [ ] 快捷操作按钮可用
- [ ] 侧边栏导航正常

**记录**:
- 发现的问题:
  -

---

#### 测试 7: 条目管理

**访问**: http://localhost:3000/admin/entries

**检查项**:
- [ ] 条目列表显示 21 个条目
- [ ] 表格显示完整信息（名称、分类、产地、状态等）
- [ ] "新建条目"按钮可用
- [ ] "编辑"按钮可用
- [ ] "删除"按钮可用（需确认）

**测试编辑**: 点击任意条目的"编辑"按钮

**检查项**:
- [ ] 编辑页面加载
- [ ] 表单预填充现有数据
- [ ] 所有字段可编辑
- [ ] 保存功能正常

**测试新建**: 点击"新建条目"

**检查项**:
- [ ] 新建页面加载
- [ ] 表单显示完整
- [ ] 必填字段标记清晰
- [ ] 提示文本显示

**记录**:
- 发现的问题:
  -

---

#### 测试 8: 批量导入

**访问**: http://localhost:3000/admin/import

**测试 JSON 导入**:

```json
[
  {
    "slug": "test-bulk-import",
    "nameZh": "测试批量导入",
    "nameJa": "テスト一括インポート",
    "category": "测试分类",
    "region": "测试产地",
    "description": "这是一个测试批量导入功能的条目。这是一个测试批量导入功能的条目。这是一个测试批量导入功能的条目。这是一个测试批量导入功能的条目。这是一个测试批量导入功能的条目。",
    "positioning": "测试定位说明",
    "signatureFeatures": ["测试特征1", "测试特征2"],
    "keywords": ["测试", "批量导入", "功能验证"],
    "notableArtists": [],
    "representativeForms": [],
    "sources": [
      {
        "title": "测试来源",
        "url": "https://example.com"
      }
    ]
  }
]
```

**检查项**:
- [ ] JSON 可粘贴到文本框
- [ ] "导入"按钮可点击
- [ ] 导入成功显示结果统计
- [ ] 新条目出现在条目列表
- [ ] 导入后可删除测试条目

**记录**:
- 导入成功数量: ________
- 发现的问题:
  -

---

#### 测试 9: 数据导出

**访问**: http://localhost:3000/admin

**测试步骤**:
1. 点击"导出数据"按钮
2. 等待下载开始

**检查项**:
- [ ] 文件开始下载
- [ ] 文件名格式正确（例如: `pottery-kb-export-2026-02-26.json`）
- [ ] 文件可用文本编辑器打开
- [ ] JSON 格式正确
- [ ] 包含所有陶器条目数据
- [ ] 包含所有作家数据

**记录**:
- 导出文件大小: ________ KB
- 发现的问题:
  -

---

#### 测试 10: 图片上传 (可选)

**访问**: http://localhost:3000/admin/entries/new

**检查项**:
- [ ] 图片上传区域显示
- [ ] 可点击选择文件
- [ ] 支持拖拽上传
- [ ] 上传后显示预览
- [ ] 可添加图片说明
- [ ] 可删除图片

**注意**: 如果没有测试图片，可以跳过此测试

**记录**:
- 发现的问题:
  -

---

### ✅ 功能测试清单总结

| 功能模块 | 状态 | 问题数 |
|---------|------|--------|
| 首页加载 | [ ] 通过 [ ] 失败 | ____ |
| 搜索功能 | [ ] 通过 [ ] 失败 | ____ |
| 详情页 | [ ] 通过 [ ] 失败 | ____ |
| 作家页面 | [ ] 通过 [ ] 失败 | ____ |
| 登录功能 | [ ] 通过 [ ] 失败 | ____ |
| 仪表盘 | [ ] 通过 [ ] 失败 | ____ |
| 条目管理 | [ ] 通过 [ ] 失败 | ____ |
| 批量导入 | [ ] 通过 [ ] 失败 | ____ |
| 数据导出 | [ ] 通过 [ ] 失败 | ____ |
| 图片上传 | [ ] 通过 [ ] 失败 [ ] 跳过 | ____ |

---

## 第三步: 问题修复 (11:00 - 12:00)

### 如果发现问题

#### 常见问题 1: 搜索功能报错

**症状**: 搜索时控制台报错或无结果

**可能原因**:
- 数据库连接问题
- MiniSearch 索引未正确构建

**解决步骤**:
```bash
# 1. 检查数据库连接
docker ps | grep postgres-pottery

# 2. 重启开发服务器
# 停止当前服务器 (Ctrl+C)
pnpm dev

# 3. 检查 API 是否正常
curl http://localhost:3000/api/search -X POST \
  -H "Content-Type: application/json" \
  -d '{"query": "备前"}'
```

---

#### 常见问题 2: 图片不显示

**症状**: 条目卡片或详情页图片显示为破碎图标

**可能原因**:
- 图片路径错误
- 图片文件不存在

**解决步骤**:
```bash
# 检查 public/uploads 目录
ls public/uploads/

# 如果目录不存在，创建它
mkdir -p public/uploads
```

**注意**: 目前可能没有实际图片文件，这是正常的。后续会添加图片素材。

---

#### 常见问题 3: 批量导入失败

**症状**: 导入时报错或无响应

**可能原因**:
- JSON 格式错误
- API 认证失败

**解决步骤**:
1. 验证 JSON 格式（使用 jsonlint.com）
2. 检查浏览器 DevTools Console 的错误信息
3. 确认环境变量 `ADMIN_PASSWORD` 正确

---

### 记录所有问题

在测试过程中发现的所有问题，记录在此:

#### 问题列表

**问题 1**:
- **描述**:
- **重现步骤**:
- **预期行为**:
- **实际行为**:
- **严重程度**: [ ] 阻塞 [ ] 主要 [ ] 次要 [ ] 建议
- **解决方案**:

**问题 2**:
- **描述**:
- **重现步骤**:
- **预期行为**:
- **实际行为**:
- **严重程度**: [ ] 阻塞 [ ] 主要 [ ] 次要 [ ] 建议
- **解决方案**:

*(继续添加...)*

---

## 第四步: 代码质量检查 (14:00 - 15:30)

### 4.1 TypeScript 类型检查

```bash
# 运行类型检查
pnpm tsc --noEmit
```

**预期结果**: 无错误

**如果有错误**:
- 记录错误信息
- 修复明显的类型错误
- 对于复杂问题，标记待后续处理

**记录**:
- TypeScript 错误数量: ________
- 主要错误类型:
  -

---

### 4.2 ESLint 代码检查

```bash
# 运行 ESLint
pnpm lint
```

**预期结果**: 无错误或警告

**如果有警告**:
- 记录警告信息
- 修复简单的 lint 问题
- 对于风格类问题，可暂时忽略

**记录**:
- ESLint 警告数量: ________
- 主要警告类型:
  -

---

### 4.3 构建测试

```bash
# 清理缓存
rm -rf .next

# 运行生产构建
pnpm build
```

**预期结果**: 构建成功

**检查构建输出**:
- [ ] 静态页面数量
- [ ] 包大小警告
- [ ] 编译时间

**记录**:
```
构建结果:
- 静态页面: ________ 个
- 总包大小: ________ KB
- 构建时间: ________ 秒
- 警告/错误: ________
```

---

### 4.4 依赖检查

```bash
# 检查未使用的依赖
npx depcheck
```

**记录**:
- 未使用的依赖:
  -
- 缺失的依赖:
  -

---

### 4.5 包大小分析 (可选)

```bash
# 分析包大小
npx @next/bundle-analyzer
```

**这会生成一个可视化报告，显示哪些包占用空间最大**

**记录**:
- 最大的包:
  1. ________ : ________ KB
  2. ________ : ________ KB
  3. ________ : ________ KB

---

## 第五步: 编写测试报告 (15:30 - 17:00)

### 创建测试报告文档

**创建文件**: `docs/test-report-phase1.md`

**报告模板**:

```markdown
# 阶段1功能测试报告

**测试日期**: 2026-02-26
**测试人员**: [Your Name]
**测试环境**: Windows 11 / Node.js 20.x / PostgreSQL 16

---

## 测试摘要

| 项目 | 数量 |
|------|------|
| 测试用例总数 | 50 |
| 通过 | ____ |
| 失败 | ____ |
| 阻塞问题 | ____ |
| 主要问题 | ____ |
| 次要问题 | ____ |

---

## 详细测试结果

### 1. 前台功能

#### 1.1 首页加载
- **状态**: ✅ 通过 / ❌ 失败
- **加载时间**: ____ ms
- **问题**:

#### 1.2 搜索功能
- **状态**: ✅ 通过 / ❌ 失败
- **响应时间**: ____ ms
- **问题**:

*(继续填写所有测试结果...)*

---

## 发现的问题

### 阻塞问题 (必须修复)

1. **[问题标题]**
   - **描述**:
   - **重现步骤**:
   - **影响**:
   - **建议解决方案**:

### 主要问题 (应该修复)

*(同上格式...)*

### 次要问题 (可后续修复)

*(同上格式...)*

---

## 性能指标

| 页面 | 加载时间 | 目标 | 状态 |
|------|----------|------|------|
| 首页 | ____ ms | < 2000ms | ✅/❌ |
| 详情页 | ____ ms | < 2000ms | ✅/❌ |
| 作家页 | ____ ms | < 2000ms | ✅/❌ |

---

## 代码质量

- **TypeScript 错误**: ____ 个
- **ESLint 警告**: ____ 个
- **构建状态**: ✅ 成功 / ❌ 失败
- **包大小**: ____ MB

---

## 建议和改进

1.
2.
3.

---

## 总结

- **阶段1完成度**: ____%
- **可进入阶段2**: ✅ 是 / ❌ 否
- **主要成就**:
- **待改进项**:

---

**报告完成时间**: 2026-02-26 17:00
```

---

## 第六步: 更新工作日志 (17:00 - 17:30)

### 更新 DAILY-LOG.md

**文件**: `docs/DAILY-LOG.md`

**添加以下内容**:

```markdown
## 📅 当前日期：2026-02-26

## ✅ 已完成任务（本日）

- [x] **TASK-2.1**: 环境启动与功能验证
  - **完成时间**: 2026-02-26 17:30
  - **实际耗时**: 6 小时
  - ✅ 数据库环境启动成功
  - ✅ 完成50+项功能测试
  - ✅ 发现并记录 ____ 个问题
  - ✅ 完成代码质量检查
  - ✅ 编写测试报告文档
  - ✅ TypeScript 类型检查: ____ 错误
  - ✅ ESLint 检查: ____ 警告
  - ✅ 生产构建: ✅ 成功 / ❌ 失败

## 📊 测试统计

| 测试项 | 通过 | 失败 | 跳过 |
|--------|------|------|------|
| 前台功能 | ____ | ____ | ____ |
| 后台功能 | ____ | ____ | ____ |
| API测试 | ____ | ____ | ____ |
| 总计 | ____ | ____ | ____ |

## ❌ 遇到的问题

### 问题 1: [问题标题]
- **描述**:
- **状态**: ⏳ 待解决 / ✅ 已解决
- **解决方案**:

## 📝 明日计划 (2026-02-27)

- **TASK-2.2**: 代码质量优化（如有问题）
- **TASK-2.3**: ISR 静态生成优化
  - 更新首页添加 revalidate
  - 优化详情页 generateStaticParams
  - 配置 Next.js 缓存
  - 测试构建和缓存效果
```

---

## 第七步: 提交代码 (17:30)

### Git 提交流程

```bash
# 1. 查看修改的文件
git status

# 2. 添加所有更改
git add .

# 3. 提交（如果有修复或改动）
git commit -m "test(phase-1): 完成阶段1功能全面测试

- 完成50+项功能测试
- 发现并记录X个问题
- 完成代码质量检查
- 编写测试报告文档

测试结果: X通过, Y失败
代码质量: TypeScript OK, ESLint OK, Build OK"

# 4. 推送到远程
git push origin phase-2-development

# 5. 如果需要，合并到 main
git checkout main
git merge phase-2-development
git push origin main
```

---

## ✅ 今日完成清单

在完成所有任务后，检查以下清单:

- [ ] 数据库环境正常运行
- [ ] 所有前台功能已测试
- [ ] 所有后台功能已测试
- [ ] 问题已记录在文档中
- [ ] 代码质量检查完成
- [ ] 测试报告已编写
- [ ] DAILY-LOG.md 已更新
- [ ] 代码已提交并推送

---

## 📊 预期成果

今天结束时，你应该有:

1. **完整的测试报告** - `docs/test-report-phase1.md`
2. **问题清单** - 记录所有发现的问题
3. **代码质量报告** - TypeScript/ESLint/构建结果
4. **更新的工作日志** - 记录今日进度

---

## 💡 额外提示

### 测试时的注意事项

1. **使用不同浏览器测试**
   - Chrome (主要)
   - Firefox
   - Safari (如果可用)
   - Edge

2. **测试不同屏幕尺寸**
   - 桌面 (1920x1080)
   - 平板 (768x1024)
   - 手机 (375x667)

3. **测试边缘情况**
   - 空搜索
   - 长文本输入
   - 特殊字符
   - 网络慢速模拟

4. **记录性能指标**
   - 使用 Chrome DevTools
   - Network 标签查看加载时间
   - Performance 标签分析性能瓶颈

---

## 🆘 需要帮助时

如果遇到无法解决的问题:

1. **记录详细信息**
   - 错误信息的完整截图
   - 重现步骤
   - 控制台日志

2. **暂停任务**
   - 不要强行继续
   - 避免产生更多问题

3. **寻求帮助**
   - 在 DAILY-LOG.md 中详细记录
   - 准备好向我提问

---

## 🎯 成功标准

今天的任务被认为成功完成，如果:

- ✅ 所有核心功能可正常使用
- ✅ 关键功能测试通过率 > 90%
- ✅ 无阻塞性问题
- ✅ 代码可成功构建
- ✅ 测试报告完整

---

**祝你今天工作顺利！如有任何问题，随时呼叫我。** 🚀

---

**文档创建时间**: 2026-02-25
**计划执行日期**: 2026-02-26
**预计完成时间**: 17:30

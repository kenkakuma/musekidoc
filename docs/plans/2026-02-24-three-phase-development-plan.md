# 日本陶艺知识库 - 三阶段开发计划

**项目名称**: Japan Pottery Knowledge Base
**文档版本**: 1.0
**创建日期**: 2026-02-24
**项目目标**: 构建一个独立的日本陶艺知识库，支持 500-2000 条目，预留与商城融合接口

---

## 📋 目录

- [阶段概览](#阶段概览)
- [阶段 1: MVP - 基础功能 + AI 内容填充](#阶段-1-mvp---基础功能--ai-内容填充)
- [阶段 2: 内容丰富 + 功能完善](#阶段-2-内容丰富--功能完善)
- [阶段 3: 高级功能 + 商城融合准备](#阶段-3-高级功能--商城融合准备)
- [技术栈总览](#技术栈总览)
- [项目约束](#项目约束)

---

## 阶段概览

| 阶段 | 目标 | 内容量 | 预估时间 | 核心价值 |
|------|------|--------|----------|----------|
| **阶段 1** | MVP 可用 + AI 填充能力 | 0 → 50 条 | 2-4 周 | 快速验证、AI 无缝填充内容 |
| **阶段 2** | 功能完善 + 性能优化 | 50 → 200-500 条 | 4-6 周 | 内容管理效率、用户体验优化 |
| **阶段 3** | 高级功能 + 融合准备 | 500+ 条 | 4-6 周 | 商业化准备、商城对接 |

---

# 阶段 1: MVP - 基础功能 + AI 内容填充

## 🎯 阶段目标

1. **快速上线可用的知识库**：前台可浏览、后台可编辑
2. **AI 无缝内容填充**：AI agents 可通过 API 或后台表单快速添加内容
3. **数据结构稳定**：建立核心数据模型，减少未来迁移成本
4. **基础搜索功能**：支持关键词搜索、分类筛选

## 📊 阶段验收标准

- ✅ 完成 14 条现有数据的迁移
- ✅ AI agents 能在 5 分钟内添加一条新条目（通过 API 或后台）
- ✅ 前台可正常浏览、搜索、查看详情
- ✅ 后台可 CRUD 操作，支持图片上传
- ✅ 数据可导出为 JSON，可从 Excel 批量导入
- ✅ 页面加载速度 < 2 秒

## 🔧 核心功能清单

### 1. 数据库与后端（优先级：🔴 最高）

#### 任务 1.1: 数据库 Schema 设计
**负责 Agent**: Backend Agent
**预估时间**: 1 天
**输出**: `prisma/schema.prisma`

**详细需求**:
```prisma
// 必须包含的模型：
1. PotteryEntry（陶器条目）
   - 基础字段：id, slug, nameZh, nameJa, nameEn
   - 分类字段：category, region, type
   - 内容字段：description, signatureFeatures, keywords
   - 媒体字段：images（JSON 数组）
   - 关联字段：artistId
   - 元数据：createdAt, updatedAt, published

2. Artist（作家）
   - 基础字段：id, slug, nameZh, nameJa
   - 社交字段：instagramHandle, instagramFollowers（预留，暂不同步）
   - 内容字段：bio, birthYear
   - 媒体字段：avatar, images

3. Category（分类）
   - 基础字段：id, slug, nameZh, nameJa
   - 层级字段：parentId（支持多级分类）

4. User（管理员）
   - 基础字段：id, email, passwordHash
   - 简化设计：单用户系统
```

**约束条件**:
- ❌ 暂不实现地图相关字段（latitude, longitude）
- ❌ 暂不实现复杂的权限系统
- ✅ 必须添加全文搜索索引（tsvector）
- ✅ 必须支持 slug 唯一性约束
- ✅ 所有 JSON 字段必须有明确的 TypeScript 类型定义

**验收标准**:
- [ ] `pnpm prisma migrate dev` 无错误
- [ ] `pnpm prisma generate` 生成类型
- [ ] 编写 `prisma/seed.ts`，包含现有 14 条数据
- [ ] `pnpm prisma db seed` 成功导入数据

---

#### 任务 1.2: API 路由设计
**负责 Agent**: Backend Agent
**预估时间**: 2 天
**输出**: `app/api/**/route.ts`

**必须实现的 API 端点**:

```typescript
// 1. 条目 API
GET    /api/entries           # 列表（支持分页、筛选、搜索）
GET    /api/entries/[id]      # 详情
POST   /api/entries           # 创建（需验证）
PUT    /api/entries/[id]      # 更新（需验证）
DELETE /api/entries/[id]      # 删除（需验证）

// 2. 搜索 API
POST   /api/search            # 全文搜索

// 3. 作家 API
GET    /api/artists           # 列表
GET    /api/artists/[slug]    # 详情
POST   /api/artists           # 创建（需验证）

// 4. 分类 API
GET    /api/categories        # 树形结构

// 5. 上传 API
POST   /api/upload/image      # 图片上传

// 6. 批量导入 API（AI agents 重点使用）
POST   /api/import/excel      # Excel 批量导入
POST   /api/import/json       # JSON 批量导入
GET    /api/export/json       # 导出所有数据
```

**API 响应格式**（标准化）:
```typescript
// 成功响应
{
  "success": true,
  "data": {...},
  "meta": {
    "total": 100,
    "page": 1,
    "pageSize": 20
  }
}

// 错误响应
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "缺少必填字段：nameZh",
    "details": {...}
  }
}
```

**约束条件**:
- ✅ 必须使用 Zod 进行参数验证
- ✅ 所有写操作（POST/PUT/DELETE）必须验证管理员身份
- ✅ 必须实现基础的 rate limiting（每分钟最多 60 次请求）
- ✅ 返回数据必须符合 TypeScript 类型定义
- ❌ 暂不实现复杂的权限控制（只区分游客/管理员）

**验收标准**:
- [ ] 使用 Postman/Thunder Client 测试所有端点
- [ ] 编写 API 文档（`docs/api.md`）
- [ ] 错误处理完整（400, 401, 404, 500）
- [ ] 日志记录关键操作

---

### 2. 前台展示（优先级：🟡 中）

#### 任务 2.1: 首页 - 搜索与列表
**负责 Agent**: Frontend Agent
**预估时间**: 2 天
**输出**: `app/(public)/page.tsx`

**功能需求**:
```
布局结构：
┌─────────────────────────────────────┐
│  Header (Logo + 导航 + 搜索框)      │
├──────────┬──────────────────────────┤
│          │                          │
│  侧边栏  │    主内容区              │
│          │                          │
│  - 分类  │  [陶器卡片网格]          │
│  - 筛选  │  [陶器卡片网格]          │
│          │  [陶器卡片网格]          │
│          │                          │
│          │  [分页器]                │
└──────────┴──────────────────────────┘
```

**具体要求**:
1. **搜索框**
   - 实时搜索（防抖 300ms）
   - 搜索范围：中文名、日文名、关键词、描述
   - 显示搜索结果数量

2. **分类树**
   - 可折叠的多级分类
   - 点击分类筛选内容
   - 显示每个分类的条目数量

3. **陶器卡片**
   - 显示：图片、中文名、日文名、产地、分类标签
   - 点击跳转到详情页
   - 图片使用 Next.js Image 组件优化

4. **筛选器**
   - 按分类筛选（陶器/磁器/作家/产地）
   - 按产地筛选（下拉菜单）

5. **排序**
   - 按中文名排序
   - 按产地排序
   - 按创建时间排序

**约束条件**:
- ✅ 必须使用 React Server Components（优先）
- ✅ 必须使用 Next.js App Router
- ✅ 搜索和筛选必须更新 URL（支持分享链接）
- ✅ 图片必须有 loading 状态和错误处理
- ❌ 暂不实现无限滚动（使用分页）
- ❌ UI 样式暂时简单（使用 shadcn/ui 默认样式）

**验收标准**:
- [ ] 可搜索并正确显示结果
- [ ] 分类筛选功能正常
- [ ] 分页功能正常（每页 20 条）
- [ ] 图片加载正常（WebP 格式）
- [ ] 响应式设计（手机端可用）

---

#### 任务 2.2: 详情页
**负责 Agent**: Frontend Agent
**预估时间**: 1.5 天
**输出**: `app/(public)/pottery/[slug]/page.tsx`

**功能需求**:
```
页面结构：
┌─────────────────────────────────────┐
│  面包屑导航                          │
├─────────────────────────────────────┤
│                                     │
│  [主图片 - 大尺寸]                  │
│                                     │
│  [图片画廊缩略图]                   │
├─────────────────────────────────────┤
│  标题：备前烧（总览）                │
│  日文：備前焼  |  英文：Bizen ware  │
├──────────┬──────────────────────────┤
│  基础信息 │  识别特征                │
│  - 分类   │  • 无釉高温烧成          │
│  - 产地   │  • 窯变分类：胡麻...     │
│  - 定位   │  • 名家：金重陶陽...     │
├──────────┼──────────────────────────┤
│  知名作家 │  代表器型                │
│  • 金重陶陽│  • 茶碗                 │
│  • 藤原雄 │  • 徳利                 │
├──────────┴──────────────────────────┤
│  参考来源                            │
│  • [链接1]                          │
│  • [链接2]                          │
└─────────────────────────────────────┘
```

**约束条件**:
- ✅ 必须实现图片画廊（点击放大查看）
- ✅ 必须使用 generateMetadata 生成 SEO 元数据
- ✅ 必须使用 generateStaticParams 预渲染热门条目（前 50 个）
- ❌ 暂不实现评论功能
- ❌ 暂不实现相关推荐

**验收标准**:
- [ ] 图片画廊功能正常（可左右切换、放大）
- [ ] SEO 元数据正确（title, description, og:image）
- [ ] 面包屑导航正确
- [ ] 所有字段正确显示（包括空值处理）

---

#### 任务 2.3: 作家列表与详情页
**负责 Agent**: Frontend Agent
**预估时间**: 1 天
**输出**: `app/(public)/artists/page.tsx`, `app/(public)/artists/[slug]/page.tsx`

**功能需求**:
- 作家列表：卡片式展示，显示头像、名字、简介
- 作家详情：完整信息 + 该作家的所有相关条目

**约束条件**:
- ✅ 作家详情页必须显示其所有相关陶器条目
- ❌ 暂不实现 Instagram 数据展示（字段预留即可）

---

### 3. 管理后台（优先级：🔴 最高，AI 内容填充核心）

#### 任务 3.1: 后台布局与身份验证
**负责 Agent**: Full-stack Agent
**预估时间**: 1 天
**输出**: `app/admin/layout.tsx`, `lib/auth.ts`

**功能需求**:
1. **简单密码保护**
   - 使用环境变量设置密码：`ADMIN_PASSWORD`
   - 访问 `/admin` 时弹出密码输入框
   - 使用 cookie 保存登录状态（24 小时有效）

2. **后台布局**
   - 左侧导航栏：仪表盘、条目管理、作家管理、批量导入、设置
   - 顶部：用户信息、退出登录

**约束条件**:
- ✅ 必须使用 bcrypt 对比密码（或简单的环境变量对比）
- ✅ 必须在 middleware.ts 中验证权限
- ❌ 暂不实现复杂的用户系统（单用户即可）

**验收标准**:
- [ ] 未登录访问 `/admin` 自动跳转到登录页
- [ ] 登录后可访问所有后台页面
- [ ] 退出登录功能正常

---

#### 任务 3.2: 条目编辑器（AI 内容填充核心）
**负责 Agent**: Full-stack Agent
**预估时间**: 3 天
**输出**: `app/admin/entries/new/page.tsx`, `app/admin/entries/[id]/edit/page.tsx`

**功能需求**:

这是 **AI agents 填充内容的主要工具**，必须设计为：
- 表单结构清晰，每个字段有明确的说明
- 支持 Markdown 编辑（描述字段）
- 支持图片拖拽上传
- 实时保存草稿
- 预览功能

**表单字段清单**:

```typescript
// 基础信息（必填）
nameZh: string          // 中文名称
nameJa: string          // 日文名称
nameEn?: string         // 英文名称（可选）
slug: string            // URL slug（自动生成，可编辑）

// 分类信息（必填）
category: select        // 下拉选择：陶器、磁器、作家、产地等
region: string          // 产地（自动补全，支持手动输入）
type?: string           // 类型（可选）

// 内容字段（必填）
description: markdown   // 描述（支持 Markdown）
positioning: string     // 定位说明

// 数组字段（可动态添加/删除）
signatureFeatures: string[]      // 识别特征（多行输入）
keywords: string[]               // 关键词（标签输入）
notableArtists: string[]         // 知名作家（可关联 Artist）
representativeForms: string[]    // 代表器型

// 媒体字段
images: File[]          // 图片上传（拖拽 + 点击）
  - 每张图片可添加 alt 和 caption
  - 可拖拽排序
  - 支持批量上传

// 来源字段（数组）
sources: Array<{
  title: string
  url: string
}>

// 关联字段
artistId?: select       // 关联作家（下拉选择）

// 社交字段（预留）
instagramHandle?: string      // Instagram 账号
instagramFollowers?: number   // 粉丝数（手动输入，未来自动同步）

// 元数据
published: boolean      // 是否发布（默认 false）
```

**表单交互要求**:
1. **自动保存**
   - 每 30 秒自动保存草稿
   - 切换字段时保存
   - 显示"已保存"/"保存中"状态

2. **图片上传**
   - 支持拖拽上传
   - 支持批量上传（一次最多 10 张）
   - 实时显示上传进度
   - 自动压缩大图（最大宽度 2000px）
   - 自动生成缩略图

3. **Slug 生成**
   - 根据中文名自动生成拼音 slug
   - 支持手动编辑
   - 实时检查 slug 唯一性

4. **实时预览**
   - 右侧显示预览面板（可选）
   - 或底部显示预览按钮（新标签页打开）

5. **验证提示**
   - 必填字段未填写时，红色边框提示
   - 提交前验证所有字段
   - 显示清晰的错误信息

**约束条件**:
- ✅ 必须使用 React Hook Form + Zod 验证
- ✅ 必须支持 Markdown 编辑器（推荐 react-markdown-editor-lite）
- ✅ 图片必须上传到 `public/images/pottery/` 目录
- ✅ 必须有明确的成功/失败提示
- ❌ 暂不实现版本历史功能
- ❌ 暂不实现协作编辑

**验收标准**:
- [ ] 可创建新条目，所有字段正常保存
- [ ] 可编辑现有条目
- [ ] 图片上传功能正常
- [ ] Markdown 编辑器可用
- [ ] 自动保存功能正常
- [ ] 表单验证正确（必填字段检查）
- [ ] AI agents 可通过此表单快速添加内容（< 5 分钟/条）

---

#### 任务 3.3: 批量导入工具（AI 内容填充加速器）
**负责 Agent**: Full-stack Agent
**预估时间**: 2 天
**输出**: `app/admin/bulk-import/page.tsx`, `app/api/import/*`

**功能需求**:

这是 **AI agents 批量填充内容的关键工具**，支持两种导入方式：

**方式 1: Excel/CSV 导入**
```
流程：
1. 下载模板 Excel（包含所有字段说明）
2. AI 填充 Excel（或人工填充）
3. 上传 Excel 文件
4. 系统解析并预览数据
5. 确认导入
6. 显示导入结果（成功/失败条目）
```

**Excel 模板格式**:
```
| nameZh | nameJa | nameEn | category | region | description | signatureFeatures | keywords | ... |
|--------|--------|--------|----------|--------|-------------|-------------------|----------|-----|
| 备前烧  | 備前焼 | Bizen  | 陶器     | 冈山   | ...         | 无釉;窯变        | 備前焼;焼締 | ... |
```

**约束条件**:
- ✅ 数组字段使用分号 `;` 分隔（如 `关键词1;关键词2;关键词3`）
- ✅ JSON 字段使用特定格式（如来源字段）
- ✅ 必须先验证数据，显示预览，再导入数据库
- ✅ 必须显示详细的错误报告（哪一行哪个字段有问题）

**方式 2: JSON 导入**
```json
[
  {
    "nameZh": "备前烧（总览）",
    "nameJa": "備前焼",
    "category": "陶器",
    "region": "冈山县・备前市",
    "description": "...",
    "signatureFeatures": ["无釉高温烧成", "窯变分类"],
    "keywords": ["備前焼", "無釉"],
    "sources": [
      {"title": "来源1", "url": "https://..."}
    ]
  }
]
```

**功能要求**:
1. **模板下载**
   - 提供 Excel 模板下载（包含示例数据）
   - 提供 JSON 模板下载

2. **文件上传**
   - 支持拖拽上传
   - 支持 .xlsx, .csv, .json 格式
   - 文件大小限制：最大 10MB

3. **数据预览**
   - 解析后显示数据表格
   - 高亮显示错误字段
   - 显示统计：总条目数、有效条目数、错误条目数

4. **错误处理**
   - 显示详细错误报告（行号 + 字段 + 错误原因）
   - 可选择"跳过错误条目"或"全部取消"

5. **导入确认**
   - 显示将要导入的条目数
   - 确认按钮

6. **导入结果**
   - 显示成功导入的条目
   - 显示失败的条目及原因
   - 提供"下载错误报告"功能

**验收标准**:
- [ ] Excel 模板可下载
- [ ] 可上传并解析 Excel/CSV 文件
- [ ] 可上传并解析 JSON 文件
- [ ] 数据验证正确（字段类型、必填项）
- [ ] 错误提示清晰
- [ ] 导入成功后数据库正确更新
- [ ] AI agents 可通过此工具批量导入 50+ 条数据

---

#### 任务 3.4: 仪表盘
**负责 Agent**: Frontend Agent
**预估时间**: 1 天
**输出**: `app/admin/page.tsx`

**功能需求**:
- 统计卡片：总条目数、已发布数、草稿数、作家数
- 最近更新的条目列表（最近 10 条）
- 快捷操作：新建条目、批量导入、导出数据

**验收标准**:
- [ ] 统计数据正确
- [ ] 快捷操作可用

---

### 4. 搜索功能（优先级：🟡 中）

#### 任务 4.1: 客户端搜索实现
**负责 Agent**: Frontend Agent
**预估时间**: 1 天
**输出**: `lib/search/index.ts`, `app/api/search/route.ts`

**技术方案**: 使用 MiniSearch

**功能需求**:
1. **索引字段**
   - nameZh, nameJa, nameEn
   - description
   - keywords
   - region

2. **搜索功能**
   - 模糊搜索
   - 中文、日文、英文混合搜索
   - 高亮搜索关键词
   - 搜索结果排序（相关度）

3. **搜索建议**
   - 输入时显示建议（debounce 300ms）
   - 显示最多 5 条建议

**约束条件**:
- ✅ 搜索索引必须在构建时生成（静态优化）
- ✅ 搜索必须在 500ms 内返回结果
- ❌ 暂不实现同义词搜索
- ❌ 暂不实现语音搜索

**验收标准**:
- [ ] 搜索结果正确
- [ ] 搜索速度 < 500ms（500 条数据）
- [ ] 支持中日英混合搜索
- [ ] 搜索建议功能正常

---

### 5. 图片管理（优先级：🟡 中）

#### 任务 5.1: 图片上传与优化
**负责 Agent**: Full-stack Agent
**预估时间**: 1 天
**输出**: `app/api/upload/image/route.ts`, `lib/image-optimizer.ts`

**功能需求**:
1. **上传处理**
   - 接收图片文件（POST multipart/form-data）
   - 验证图片格式（JPEG, PNG, WebP）
   - 验证文件大小（< 5MB）
   - 重命名文件（UUID + 原扩展名）

2. **图片优化**
   - 使用 Sharp 库压缩图片
   - 生成 WebP 格式
   - 生成多种尺寸：
     - `thumb`: 200x200（缩略图）
     - `medium`: 800x800（列表）
     - `large`: 1600x1600（详情）
     - `original`: 保留原图

3. **存储结构**
```
public/images/pottery/
  ├── [uuid]/
  │   ├── thumb.webp
  │   ├── medium.webp
  │   ├── large.webp
  │   └── original.jpg
```

4. **返回数据**
```json
{
  "success": true,
  "data": {
    "id": "uuid",
    "urls": {
      "thumb": "/images/pottery/[uuid]/thumb.webp",
      "medium": "/images/pottery/[uuid]/medium.webp",
      "large": "/images/pottery/[uuid]/large.webp",
      "original": "/images/pottery/[uuid]/original.jpg"
    },
    "width": 1920,
    "height": 1080
  }
}
```

**约束条件**:
- ✅ 必须使用 Sharp 库优化图片
- ✅ 必须生成 WebP 格式
- ✅ 必须限制文件大小和格式
- ❌ 暂不使用 CDN（本地存储）
- ❌ 暂不实现图片裁剪功能

**验收标准**:
- [ ] 可上传图片并生成多种尺寸
- [ ] WebP 格式生成正确
- [ ] 文件大小验证正常
- [ ] 返回 URL 可访问

---

### 6. 数据导入导出（优先级：🟡 中）

#### 任务 6.1: 现有数据迁移
**负责 Agent**: Backend Agent
**预估时间**: 0.5 天
**输出**: `scripts/migrate-existing-data.ts`

**功能需求**:
- 读取现有的 HTML 文件中的 14 条数据
- 转换为 Prisma 数据模型
- 导入到数据库

**验收标准**:
- [ ] 14 条数据全部导入成功
- [ ] 数据字段映射正确

---

#### 任务 6.2: JSON 导出功能
**负责 Agent**: Backend Agent
**预估时间**: 0.5 天
**输出**: `app/api/export/json/route.ts`

**功能需求**:
- 导出所有条目为 JSON 格式
- 包含完整的关联数据（作家信息等）
- 支持下载为文件

**验收标准**:
- [ ] 可导出所有数据
- [ ] JSON 格式正确
- [ ] 文件可下载

---

### 7. 基础 UI 组件（优先级：🟢 低，使用 shadcn/ui 默认样式）

#### 任务 7.1: 安装 shadcn/ui 基础组件
**负责 Agent**: Frontend Agent
**预估时间**: 0.5 天

**需要安装的组件**:
```bash
npx shadcn-ui@latest add button
npx shadcn-ui@latest add card
npx shadcn-ui@latest add input
npx shadcn-ui@latest add select
npx shadcn-ui@latest add textarea
npx shadcn-ui@latest add dialog
npx shadcn-ui@latest add badge
npx shadcn-ui@latest add table
npx shadcn-ui@latest add form
```

**约束条件**:
- ❌ 暂不定制主题（使用默认样式）
- ❌ 暂不实现复杂动画

---

### 8. 部署配置（优先级：🟢 低）

#### 任务 8.1: 环境配置
**负责 Agent**: DevOps Agent
**预估时间**: 0.5 天

**需要配置的环境变量**:
```env
# 数据库
DATABASE_URL=postgresql://user:password@localhost:5432/pottery_kb

# 管理员
ADMIN_PASSWORD=your-secure-password

# Next.js
NEXT_PUBLIC_APP_URL=http://localhost:3000

# 图片上传
MAX_FILE_SIZE=5242880  # 5MB
ALLOWED_IMAGE_TYPES=image/jpeg,image/png,image/webp
```

**验收标准**:
- [ ] 本地开发环境可运行
- [ ] 环境变量配置正确
- [ ] `.env.example` 文件已创建

---

## 📦 阶段 1 可交付成果

### 代码仓库
- ✅ 完整的 Next.js 项目
- ✅ Prisma Schema 和 migrations
- ✅ 所有 API 端点
- ✅ 前台页面（首页、详情、作家）
- ✅ 管理后台（编辑器、批量导入）

### 数据
- ✅ 14 条现有数据已迁移
- ✅ 数据库 seed 文件

### 文档
- ✅ API 文档（`docs/api.md`）
- ✅ 数据模型文档（`docs/data-model.md`）
- ✅ 部署文档（`docs/deployment.md`）
- ✅ AI 内容填充指南（`docs/ai-content-guide.md`）

### 测试
- ✅ 手动测试所有功能
- ✅ API 端点测试

---

## 🎯 阶段 1 AI 内容填充工作流

**目标**: AI agents 能够在 5 分钟内添加一条新条目

**推荐工作流 1: 通过管理后台表单**
```
1. AI 研究某个陶器类型/作家
2. 访问 /admin/entries/new
3. 填写表单（复制粘贴文本，上传图片）
4. 保存
```

**推荐工作流 2: 通过批量导入**
```
1. AI 生成 50 条数据的 JSON 文件
2. 访问 /admin/bulk-import
3. 上传 JSON 文件
4. 预览并确认
5. 批量导入
```

**推荐工作流 3: 通过 API（适合自动化）**
```typescript
// AI 脚本调用 API
const response = await fetch('http://localhost:3000/api/entries', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer admin-token'
  },
  body: JSON.stringify({
    nameZh: '备前烧',
    nameJa: '備前焼',
    category: '陶器',
    // ... 其他字段
  })
})
```

---

# 阶段 2: 内容丰富 + 功能完善

## 🎯 阶段目标

1. **内容达到 200-500 条**：持续使用阶段 1 工具填充内容
2. **性能优化**：应对大数据量，优化加载速度
3. **后台功能完善**：批量编辑、内容审核、统计分析
4. **用户体验优化**：改进搜索、添加筛选、优化交互

## 📊 阶段启动条件

- ✅ 阶段 1 所有功能已完成
- ✅ 内容量达到 50+ 条
- ✅ 经过 1-2 周的内容填充实践，了解瓶颈

## 🔧 核心功能清单

### 1. 性能优化（优先级：🔴 最高）

#### 任务 2.1.1: 数据库查询优化
**预估时间**: 1 天

**优化点**:
- 添加数据库索引（基于查询分析）
- 优化复杂查询（JOIN 优化）
- 实现数据库连接池
- 添加查询日志，分析慢查询

**验收标准**:
- [ ] 列表页加载时间 < 1 秒（500 条数据）
- [ ] 搜索响应时间 < 300ms

---

#### 任务 2.1.2: 静态生成优化
**预估时间**: 1 天

**优化点**:
- 使用 ISR（Incremental Static Regeneration）
- 预渲染热门条目（前 100 个）
- 按需生成详情页
- 配置合理的 revalidate 时间

**验收标准**:
- [ ] 首次访问详情页 < 1 秒
- [ ] 静态页面缓存命中率 > 80%

---

#### 任务 2.1.3: 图片优化
**预估时间**: 1 天

**优化点**:
- 实现图片懒加载
- 使用 blur placeholder
- 优化图片压缩参数
- 实现图片预加载（关键图片）

**验收标准**:
- [ ] 首屏图片加载时间 < 1 秒
- [ ] Lighthouse 性能分数 > 90

---

### 2. 后台功能完善（优先级：🔴 最高）

#### 任务 2.2.1: 批量编辑
**预估时间**: 2 天

**功能需求**:
- 多选条目
- 批量修改分类、产地、状态
- 批量添加标签
- 批量删除

**验收标准**:
- [ ] 可同时编辑 10+ 条目
- [ ] 操作后正确更新数据库

---

#### 任务 2.2.2: 内容审核工作流
**预估时间**: 1.5 天

**功能需求**:
- 添加状态：草稿、待审核、已发布
- 审核列表页面
- 审核历史记录

**验收标准**:
- [ ] 状态切换正常
- [ ] 前台只显示"已发布"条目

---

#### 任务 2.2.3: 统计分析
**预估时间**: 1 天

**功能需求**:
- 内容统计图表（按分类、产地）
- 增长趋势图（每日新增）
- 热门条目排行（基于浏览量）

**验收标准**:
- [ ] 图表显示正确
- [ ] 数据实时更新

---

### 3. 搜索与导航增强（优先级：🟡 中）

#### 任务 2.3.1: 高级筛选
**预估时间**: 2 天

**功能需求**:
- 多条件筛选（分类 + 产地 + 标签）
- 筛选器 UI 优化
- 筛选结果数量实时显示
- 清空筛选功能

**验收标准**:
- [ ] 可同时应用多个筛选条件
- [ ] 筛选器 UI 易用

---

#### 任务 2.3.2: 标签云实现
**预估时间**: 1 天

**功能需求**:
- 可视化显示所有标签
- 标签大小反映使用频率
- 点击标签筛选内容

**验收标准**:
- [ ] 标签云显示正确
- [ ] 点击筛选功能正常

---

#### 任务 2.3.3: 分类树优化
**预估时间**: 1 天

**功能需求**:
- 支持拖拽排序
- 支持多级分类（最多 3 级）
- 分类管理页面

**验收标准**:
- [ ] 分类树可折叠/展开
- [ ] 拖拽排序正常

---

### 4. 内容增强（优先级：🟡 中）

#### 任务 2.4.1: 富文本编辑器升级
**预估时间**: 1 天

**功能需求**:
- 支持插入图片
- 支持表格
- 支持代码块
- 支持引用块

**验收标准**:
- [ ] 编辑器功能完整
- [ ] 渲染正确

---

#### 任务 2.4.2: 相关推荐
**预估时间**: 1.5 天

**功能需求**:
- 详情页底部显示相关条目
- 基于标签相似度推荐
- 最多显示 6 条

**验收标准**:
- [ ] 推荐结果相关性高
- [ ] 推荐速度快

---

### 5. 用户体验优化（优先级：🟡 中）

#### 任务 2.5.1: 响应式设计完善
**预估时间**: 2 天

**优化点**:
- 移动端导航优化
- 触摸手势支持
- 移动端图片优化

**验收标准**:
- [ ] 移动端可正常使用所有功能
- [ ] 触摸操作流畅

---

#### 任务 2.5.2: 加载状态优化
**预估时间**: 1 天

**优化点**:
- 骨架屏（Skeleton）
- 加载动画
- 错误状态处理

**验收标准**:
- [ ] 所有页面有加载状态
- [ ] 错误提示清晰

---

### 6. 数据管理增强（优先级：🟢 低）

#### 任务 2.6.1: 数据备份
**预估时间**: 1 天

**功能需求**:
- 自动备份数据库（每日）
- 手动备份按钮
- 备份文件管理

**验收标准**:
- [ ] 备份功能正常
- [ ] 可恢复备份

---

#### 任务 2.6.2: 数据导出增强
**预估时间**: 1 天

**功能需求**:
- 导出为 Excel
- 导出为 Markdown
- 按筛选条件导出

**验收标准**:
- [ ] 可导出多种格式
- [ ] 格式正确

---

## 📦 阶段 2 可交付成果

- ✅ 内容量达到 200-500 条
- ✅ 所有性能优化完成
- ✅ 后台管理功能完善
- ✅ 用户体验显著提升
- ✅ 更新文档

---

# 阶段 3: 高级功能 + 商城融合准备

## 🎯 阶段目标

1. **内容达到 500+ 条**：知识库基本完整
2. **高级功能**：Instagram 同步、地图、时间线
3. **UI/UX 定制**：日式和风设计实现
4. **商城融合准备**：API 对接、数据同步

## 📊 阶段启动条件

- ✅ 阶段 2 所有功能已完成
- ✅ 内容量达到 200+ 条
- ✅ 性能稳定

## 🔧 核心功能清单

### 1. Instagram 数据同步（优先级：🔴 最高）

#### 任务 3.1.1: Instagram API 集成
**预估时间**: 3 天

**功能需求**:
- 使用 Instagram Basic Display API
- 获取粉丝数、作品数
- 自动同步（每日）
- 手动触发同步

**验收标准**:
- [ ] 可获取 Instagram 数据
- [ ] 自动同步正常

---

### 2. 地图功能（优先级：🟡 中）

#### 任务 3.2.1: 地图浏览页面
**预估时间**: 3 天

**功能需求**:
- 使用 Leaflet.js
- 在地图上标注产地
- 点击标记显示该产地的条目
- 支持地图筛选

**验收标准**:
- [ ] 地图显示正确
- [ ] 交互流畅

---

### 3. 时间线功能（优先级：🟡 中）

#### 任务 3.3.1: 时间线浏览
**预估时间**: 2 天

**功能需求**:
- 按年代显示陶器发展
- 时间线可视化
- 点击查看详情

**验收标准**:
- [ ] 时间线显示正确
- [ ] 数据准确

---

### 4. UI/UX 日式设计（优先级：🟡 中）

#### 任务 3.4.1: 主题定制
**预估时间**: 3 天

**设计方向**:
- 和纸质感背景
- 传统配色
- 日式字体
- 细腻动画

**验收标准**:
- [ ] 视觉效果符合日式美学
- [ ] 用户反馈良好

---

### 5. 商城融合准备（优先级：🔴 最高）

#### 任务 3.5.1: API 标准化
**预估时间**: 2 天

**功能需求**:
- OpenAPI 规范
- 版本控制
- CORS 配置
- Webhook 接口

**验收标准**:
- [ ] API 文档完整
- [ ] 商城可调用 API

---

#### 任务 3.5.2: 商品关联功能
**预估时间**: 2 天

**功能需求**:
- 陶器条目可关联商城商品 ID
- 显示"购买链接"
- 数据同步接口

**验收标准**:
- [ ] 关联功能正常
- [ ] 链接跳转正确

---

### 6. 其他高级功能（优先级：🟢 低）

- 用户评论系统
- 收藏功能
- 分享功能
- 多语言支持

---

## 📦 阶段 3 可交付成果

- ✅ 完整的知识库（500+ 条）
- ✅ Instagram 数据同步
- ✅ 地图、时间线功能
- ✅ 日式 UI 设计
- ✅ 商城融合接口
- ✅ 完整文档

---

# 技术栈总览

```yaml
前端:
  框架: Next.js 14 (App Router)
  语言: TypeScript 5
  UI: Tailwind CSS + shadcn/ui
  状态: Zustand
  表单: React Hook Form + Zod
  搜索: MiniSearch
  地图: Leaflet.js (阶段 3)
  图片: yet-another-react-lightbox

后端:
  运行时: Node.js 20 LTS
  API: Next.js API Routes
  数据库: PostgreSQL 16
  ORM: Prisma 5
  验证: Zod
  图片处理: Sharp

开发工具:
  包管理: pnpm
  代码规范: ESLint + Prettier
  Git: GitHub
  部署: Vercel (或 EC2)
```

---

# 项目约束

## 必须遵守

1. **独立性**
   - ❌ 不依赖商城代码
   - ✅ 独立 Git 仓库
   - ✅ 独立数据库

2. **技术栈**
   - ✅ Next.js 14 App Router
   - ✅ TypeScript（强制）
   - ✅ Prisma ORM

3. **数据**
   - ✅ 可导出 JSON
   - ✅ 支持批量导入
   - ✅ 图片本地存储

4. **性能**
   - ✅ 首页 < 2 秒
   - ✅ 搜索 < 500ms

5. **安全**
   - ✅ 管理后台密码保护
   - ✅ API rate limiting

## 阶段性约束

**阶段 1**:
- ❌ 不实现地图
- ❌ 不实现视频
- ❌ 不实现 Instagram 同步
- ❌ UI 使用 shadcn/ui 默认样式

**阶段 2**:
- ✅ 可开始性能优化
- ✅ 可添加复杂筛选

**阶段 3**:
- ✅ 可实现地图
- ✅ 可实现 Instagram 同步
- ✅ 可定制 UI

---

# AI Agents 工作指南

## 推荐角色分工

```
Backend Agent:
  - 数据库设计
  - API 开发
  - 数据导入导出

Frontend Agent:
  - 页面开发
  - 组件开发
  - UI 集成

Full-stack Agent:
  - 管理后台
  - 图片上传
  - 搜索功能

DevOps Agent:
  - 环境配置
  - 部署
  - 性能监控
```

## 任务执行规范

1. **每个任务都必须包含**:
   - 明确的输出文件
   - 验收标准
   - 约束条件

2. **代码规范**:
   - 使用 TypeScript
   - 添加必要的注释
   - 遵循 ESLint 规则

3. **测试要求**:
   - 手动测试所有功能
   - 记录测试结果

4. **文档要求**:
   - 更新相关文档
   - 添加代码注释

---

# 附录

## A. 数据模型 ER 图

```
PotteryEntry 1--* Image
PotteryEntry *--1 Artist
PotteryEntry *--1 Category
Artist 1--* PotteryEntry
Category 1--* Category (self-reference)
```

## B. API 端点总览

见 `docs/api.md`（阶段 1 完成后生成）

## C. 参考资源

- Next.js 14 文档: https://nextjs.org/docs
- Prisma 文档: https://www.prisma.io/docs
- shadcn/ui: https://ui.shadcn.com/
- MiniSearch: https://github.com/lucaong/minisearch

---

**文档结束**
